# μ½ν…μΈ  μ•”νΈν™” API

## π“– κ°μ”
μ΄ ν”„λ΅μ νΈλ” REST APIλ¥Ό ν†µν•΄ μ½ν…μΈ λ¥Ό μ•μ „ν•κ² μ κ³µν•λ” μ‹μ¤ν…μ„ μ‹¤μ¦ν•©λ‹λ‹¤. **AES-256-GCM**μ„ μ‚¬μ©ν•μ—¬ μ½ν…μΈ λ¥Ό λ³΄νΈν•κ³  **ECDH (P-256)**λ¥Ό ν†µν•΄ μ•μ „ν•κ² ν‚¤λ¥Ό κµν™ν•λ©°, μΈμ¦λ ν΄λΌμ΄μ–ΈνΈμ—κ² λ„λ‹¬ν•  λ•κΉμ§€ μ½ν…μΈ κ°€ μ•”νΈν™”λ μƒνƒλ΅ μ μ§€λλ„λ΅ λ³΄μ¥ν•©λ‹λ‹¤.

## π€ μ£Όμ” κΈ°λ¥
- **μ•μ „ν• ν‚¤ κµν™**: P-256 κ³΅μ„ μ—μ„ νƒ€μ› κ³΅μ„  λ””ν”Ό-ν—¬λ¨Ό(ECDH)μ„ μ‚¬μ©ν•©λ‹λ‹¤.
- **κ°•λ ¥ν• μ•”νΈν™”**: μ½ν…μΈ λ” AES-256 GCM λ¨λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ©λ‹λ‹¤.
- **ν΄λΌμ΄μ–ΈνΈ μΈμ¦**: νƒ€μ„μ¤νƒ¬ν”„μ™€ μ†”νΈ(Salt)κ°€ ν¬ν•¨λ HMAC-SHA256 μ„λ…μ„ μ‚¬μ©ν•μ—¬ ν΄λΌμ΄μ–ΈνΈλ¥Ό κ²€μ¦ν•κ³  μ¬μ „μ†΅ κ³µκ²©μ„ λ°©μ§€ν•©λ‹λ‹¤.
- **Replay Attack λ°©μ–΄**: Redis κΈ°λ° Nonce κ²€μ¦μΌλ΅ λ™μΌ μ”μ²­μ μ¬μ‚¬μ©μ„ λ°©μ§€ν•©λ‹λ‹¤.
- **SSE μ¤νΈλ¦¬λ°**: λ€μ©λ‰ μ½ν…μΈ λ¥Ό Chunk λ‹¨μ„λ΅ μ•”νΈν™”ν•μ—¬ μ‹¤μ‹κ°„ μ¤νΈλ¦¬λ°ν•©λ‹λ‹¤.
- **μ»¨ν…μ¤νΈ λ°”μΈλ”©**: HKDF Infoμ™€ AES-GCM AADμ— `entry-id`μ™€ `timestamp`λ¥Ό ν¬ν•¨ν•μ—¬ μ•”νΈλ¬Έμ μ©λ„λ¥Ό κ²©λ¦¬ν•©λ‹λ‹¤.
- **ν¬λ΅μ¤ ν”λ«νΌ**: λ‹¤μ ν”λ«νΌμ— λ€ν• μ°Έμ΅° κµ¬ν„μ„ ν¬ν•¨ν•©λ‹λ‹¤:
  - **λ°±μ—”λ“**: Spring Boot 3.5 (Java 21)
  - **μ›Ή**: Web Crypto APIλ¥Ό μ‚¬μ©ν•λ” Vanilla JS
  - **μ›Ή (WASM)**: Rust β†’ WebAssembly μ»΄νμΌ
  - **iOS**: Swift (CryptoKit)
  - **Android**: Kotlin
  - **Java Client**: OkHttp κΈ°λ° REST/Streaming ν΄λΌμ΄μ–ΈνΈ

## π“ ν”„λ΅μ νΈ κµ¬μ΅°
```
api-encrypt/
β”β”€β”€ backend/          # Spring Boot 3.5 API μ„λ²„ (Java 21)
β”β”€β”€ web/              # Vanilla JS ν΄λΌμ΄μ–ΈνΈ (Web Crypto API)
β”β”€β”€ web-wasm/         # Rust β†’ WebAssembly ν΄λΌμ΄μ–ΈνΈ
β”β”€β”€ ios/              # Swift ν΄λΌμ΄μ–ΈνΈ (CryptoKit)
β”β”€β”€ aos/              # Kotlin Android ν΄λΌμ΄μ–ΈνΈ
β”β”€β”€ java-client/      # Java κΈ°λ° REST/Streaming ν΄λΌμ΄μ–ΈνΈ
β”β”€β”€ ENCRYPTION_SPECS.md
β”β”€β”€ SECURITY_CONSIDERATIONS.md
β””β”€β”€ README.md
```

## π›  κΈ°μ  μ¤νƒ
| μ»΄ν¬λ„νΈ | κΈ°μ  | μ‚¬μ© μ‚¬λ΅€ |
|-----------|------------|----------|
| **Backend** | Java 21, Spring Boot 3.5, Redis | API μ„λ²„, μ•”νΈν™” λ΅μ§, Replay λ°©μ–΄ |
| **Web** | HTML5, JavaScript, Web Crypto API | λΈλΌμ°μ € κΈ°λ° λ³µνΈν™” |
| **Web (WASM)** | Rust, wasm-bindgen, aes-gcm, p256 | κ³ μ„±λ¥ λΈλΌμ°μ € λ³µνΈν™” + λ‚λ…ν™” |
| **iOS** | Swift, CryptoKit | λ„¤μ΄ν‹°λΈ iOS ν΄λΌμ΄μ–ΈνΈ |
| **Android** | Kotlin, javax.crypto | λ„¤μ΄ν‹°λΈ Android ν΄λΌμ΄μ–ΈνΈ |
| **Java Client** | Java, OkHttp, Jackson | REST/SSE μ¤νΈλ¦¬λ° ν΄λΌμ΄μ–ΈνΈ |

## π” μ•”νΈν™” ν”„λ΅ν† μ½
μ΄ μ‹μ¤ν…μ€ κ²¬κ³ ν• μΈμ¦ + ν‚¤ κµν™ + μ•”νΈν™” ν”„λ΅μ„Έμ¤λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤:

1.  **ν•Έλ“μ…°μ΄ν¬ μ”μ²­**: ν΄λΌμ΄μ–ΈνΈλ” ECDH κ³µκ° ν‚¤, Random Salt(32bytes), Timestamp, HMAC μ„λ…μ„ μ „μ†΅ν•©λ‹λ‹¤.
    - νμ΄λ΅λ“: `{ publicKey, timestamp, signature, salt }`
2.  **μ„λ²„ κ²€μ¦** (3λ‹¨κ³„):
    - **νƒ€μ„μ¤νƒ¬ν”„ κ²€μ¦**: μ”μ²­ μ‹κ°„μ΄ 5λ¶„ μ΄λ‚΄μΈμ§€ ν™•μΈν•©λ‹λ‹¤.
    - **HMAC μ„λ… κ²€μ¦**: `PublicKey + Timestamp + Salt`λ¥Ό `CLIENT_SECRET`μΌλ΅ μ„λ…ν•μ—¬ μΌμΉ μ—¬λ¶€λ¥Ό ν™•μΈν•©λ‹λ‹¤.
    - **Replay Attack λ°©μ–΄**: Redis SETNXλ΅ λ™μΌ μ”μ²­μ μ¬μ‚¬μ©μ„ μ°¨λ‹¨ν•©λ‹λ‹¤.
3.  **ν‚¤ μ λ„**:
    - ECDHλ¥Ό ν†µν•΄ `κ³µμ  λΉ„λ°€(Shared Secret)`μ„ κ³„μ‚°ν•©λ‹λ‹¤.
    - ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ `Salt`μ™€ `"entry-id:{entryId}|ts:{timestamp}"` Infoλ¥Ό μ‚¬μ©ν•μ—¬ **HKDF-SHA256**μΌλ΅ `μ„Έμ… ν‚¤(Session Key)`λ¥Ό μ λ„ν•©λ‹λ‹¤.
4.  **μ½ν…μΈ  μ „μ†΅**: μ„λ²„λ” μ„λ²„μ κ³µκ° ν‚¤μ™€ μ•”νΈν™”λ μ½ν…μΈ (AES-256-GCM + AAD)λ¥Ό μ‘λ‹µν•©λ‹λ‹¤.
    - μ‘λ‹µ: `{ publicKey, content }`

μƒμ„Έν• μ•”νΈν™” λ…μ„Έλ” [ENCRYPTION_SPECS.md](ENCRYPTION_SPECS.md)λ¥Ό μ°Έμ΅°ν•μ‹­μ‹μ¤.

## π€ μ‹¤ν–‰ λ°©λ²•

### μ‚¬μ „ μ”κµ¬μ‚¬ν•­
- Java 21+
- Redis (Replay Attack λ°©μ–΄μ— μ‚¬μ©, `localhost:6379`)

### 1. Backend (Java/Spring Boot)
API μ„λ²„λ¥Ό λ¨Όμ € μ‹¤ν–‰ν•΄μ•Ό ν•©λ‹λ‹¤.

```bash
cd backend
./gradlew bootRun
```
*   μ„λ²„λ” κΈ°λ³Έμ μΌλ΅ `http://localhost:8080`μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.
*   REST API: `POST /api/novels/{id}`
*   Streaming API: `POST /api/novels/{id}/stream?chunkSize=100`

### 2. Web Client
λ³„λ„μ λΉλ“ μ—†μ΄ λΈλΌμ°μ €μ—μ„ λ°”λ΅ νμΌμ„ μ—΄μ–΄ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.

1.  `web/index.html` νμΌμ„ λΈλΌμ°μ €(Chrome, Safari λ“±)λ΅ μ—½λ‹λ‹¤.
2.  ν™”λ©΄μ λ²„νΌμ„ ν΄λ¦­ν•μ—¬ ν‚¤ κµν™ λ° λ³µνΈν™” κ³Όμ •μ„ ν™•μΈν•©λ‹λ‹¤.

### 3. Web (WASM) Client
Rust β†’ WebAssemblyλ΅ μ»΄νμΌλ ν΄λΌμ΄μ–ΈνΈμ…λ‹λ‹¤.

1.  `web-wasm/` ν΄λ”μ—μ„ `wasm-pack build --target web`μΌλ΅ λΉλ“ν•©λ‹λ‹¤.
2.  `web-wasm/index.html`μ„ λ΅μ»¬ HTTP μ„λ²„λ΅ μ—΄μ–΄ ν…μ¤νΈν•©λ‹λ‹¤.

### 4. iOS Client (NovelApp)
1.  `ios/NovelApp` ν΄λ”λ¥Ό Xcodeλ΅ μ—½λ‹λ‹¤.
2.  `CryptoManager.swift`μ URLμ΄ λ΅μ»¬ μ„λ²„(`localhost`)λ¥Ό κ°€λ¦¬ν‚¤κ³  μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    *   *μ£Όμ: μ‹λ®¬λ μ΄ν„°μ—μ„λ” `localhost`κ°€ νΈμ¤νΈ PCλ¥Ό κ°€λ¦¬ν‚¤μ§€λ§, μ‹¤μ  κΈ°κΈ°μ—μ„λ” PCμ λ‚΄λ¶€ IP(μ: `192.168.x.x`)λ΅ λ³€κ²½ν•΄μ•Ό ν•©λ‹λ‹¤.*
3.  μ•±μ„ λΉλ“ν•κ³  μ‹¤ν–‰ν•©λ‹λ‹¤.

### 5. Android Client
1.  `aos` ν΄λ”λ¥Ό Android Studioλ΅ μ—½λ‹λ‹¤.
2.  `CryptoManager.kt`μ—μ„ μ„λ²„ URLμ„ ν™•μΈν•©λ‹λ‹¤.
    *   *μ—λ®¬λ μ΄ν„° μ‚¬μ© μ‹ `10.0.2.2`κ°€ νΈμ¤νΈ PCμ `localhost`μ…λ‹λ‹¤.*
3.  μ•±μ„ λΉλ“ν•κ³  μ‹¤ν–‰ν•©λ‹λ‹¤.

### 6. Java Client
```bash
cd java-client
./gradlew run
```
*   REST μ”μ²­(`RestApiClient`) λλ” SSE μ¤νΈλ¦¬λ°(`StreamingApiClient`)μ„ μ‹¤ν–‰ν•©λ‹λ‹¤.

---

## β οΈ λ³΄μ• μ£Όμμ‚¬ν•­ (Security Notice)

μ΄ μμ  μ½”λ“λ” ν•™μµ λ° λ°λ¨ λ©μ μΌλ΅ μ‘μ„±λμ—μµλ‹λ‹¤. μ‹¤μ  μ„λΉ„μ¤ λ„μ… μ‹ λ‹¤μ μ‚¬ν•­μ„ λ°λ“μ‹ λ³΄μ™„ν•΄μ•Ό ν•©λ‹λ‹¤.

1.  **Client Secret κ΄€λ¦¬**:
    *   ν„μ¬ μ½”λ“μ—λ” ν΄λΌμ΄μ–ΈνΈ μΈμ¦μ„ μ„ν•΄ `auth-secret-1234`κ°€ ν•λ“μ½”λ”©λμ–΄ μμµλ‹λ‹¤.
    *   **κ°μ„  ν•„μ”**: μ‹¤μ  ν™κ²½μ—μ„λ” μ•± λ‚΄μ— Secretμ„ μ €μ¥ν•μ§€ λ§κ³ , μ‚¬μ©μ λ΅κ·ΈμΈ ν›„ λ°κΈ‰λ°›μ€ **μΌνμ„± μ„Έμ… ν† ν°** λ“±μ„ μ‚¬μ©ν•μ—¬ μΈμ¦ν•΄μ•Ό ν•©λ‹λ‹¤.
2.  **HTTPS μ‚¬μ©**:
    *   λ¨λ“  ν†µμ‹ μ€ λ°λ“μ‹ HTTPS(TLS) μ„μ—μ„ μ΄λ£¨μ–΄μ Έμ•Ό ν•©λ‹λ‹¤.
3.  **μ—λ¬ μ²λ¦¬**:
    *   λ³΄μ• κ΄€λ ¨ μ—λ¬(λ³µνΈν™” μ‹¤ν¨ λ“±) λ°μƒ μ‹, κ³µκ²©μμ—κ² μƒμ„Έν• μ •λ³΄λ¥Ό λ…Έμ¶ν•μ§€ μ•λ„λ΅ μΌλ°μ μΈ μ—λ¬ λ©”μ‹μ§€λ§ λ°ν™ν•΄μ•Ό ν•©λ‹λ‹¤.
    *   ν„μ¬ κµ¬ν„μ—μ„λ” `ResponseStatusException`μ„ μ‚¬μ©ν•μ—¬ μ μ ν• HTTP μƒνƒ μ½”λ“(401, 500)λ¥Ό λ°ν™ν•©λ‹λ‹¤.

μμ„Έν• λ³΄μ• κ³ λ ¤ μ‚¬ν•­μ€ [SECURITY_CONSIDERATIONS.md](SECURITY_CONSIDERATIONS.md)λ¥Ό μ°Έμ΅°ν•μ‹­μ‹μ¤.
